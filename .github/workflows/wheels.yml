name: Build wheels

on: [push, pull_request]

jobs:
  build_wheels:
    name: Build wheels on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        # cibuildwheel builds linux wheels inside a manylinux container
        # it also takes care of procuring the correct python version for us
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: [38, 39]
    steps:
      - uses: actions/checkout@v3

      - name: Build wheels
        uses: pypa/cibuildwheel@v2.8.0

      - uses: actions/upload-artifact@v3
        with:
          path: ./wheelhouse/*.whl

    # steps:
    #   - uses: actions/checkout@v2
    #   - uses: actions/setup-python@v2
    #     name: Install Python
    #     with:
    #       python-version: "3.7"
    #   - name: Install cibuildwheel
    #     run: |
    #       python -m pip install "cibuildwheel==2.1.3"
    #   - name: Checkout mypy
    #     shell: bash
    #     # use a commit hash checked into a file to get the mypy revision to build.
    #     # submodules prove problematic since .git is outside cibuildwheel's manylinux container
    #     run: |
    #       COMMIT=$(cat mypy_commit)
    #       git clone https://github.com/python/mypy.git
    #       cd mypy
    #       git checkout $COMMIT
    #       git submodule update --init --recursive
    #   - name: Build wheels
    #     run: |
    #       python mypy/misc/build_wheel.py --output-dir wheelhouse --python-version ${{ matrix.python-version}}
    #   - uses: actions/upload-artifact@v2
    #     with:
    #       name: dist
    #       path: ./wheelhouse/*.whl

# jobs:
#   build_wheels:
#     name: Build wheels # on ${{ matrix.os }}
#     runs-on: ${{ matrix.os }}
#     strategy:
#       # Ensure that a wheel builder finishes even if another fails
#       fail-fast: false
#       matrix:
#         # Github Actions doesn't support pairing matrix values together, let's improvise
#         # https://github.com/github/feedback/discussions/7835#discussioncomment-1769026
#         buildplat:
#         - [ubuntu-20.04, manylinux_x86_64]
#         - [macos-10.15, macosx_*]
#         # - [windows-2019, win_amd64]
#         # - [windows-2019, win32]
#         python: ["cp38", "cp39"] #, "pp39"]
#         exclude:
#         # Don't build PyPy 32-bit windows
#         - buildplat: [windows-2019, win32]
#           python: "pp38"
#         - buildplat: [windows-2019, win32]
#           python: "pp39"
#
#     steps:
#       - uses: actions/checkout@v2
#
#       # Used to host cibuildwheel
#       - uses: actions/setup-python@v2
#
#       - name: Install cibuildwheel
#         run: python -m pip install cibuildwheel==2.6.1
#
#       - name: Build wheels
#         run: python -m cibuildwheel --output-dir wheelhouse
#         # to supply options, put them in 'env', like:
#         # env:
#         #   CIBW_SOME_OPTION: value
#
#       - uses: actions/upload-artifact@v2
#         with:
#           path: ./wheelhouse/*.whl
